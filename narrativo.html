<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Gestión de Proyectos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #2c3e50; margin-top: 40px; }
        .tab { display: none; }
        .tab.active { display: block; }
        .nav { margin-bottom: 20px; }
        .nav button { margin-right: 10px; padding: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f4f4f4; }
        .form-section { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        .btn { padding: 6px 10px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-primary { background: #3498db; color: #fff; }
        .btn-danger { background: #e74c3c; color: #fff; }
        .btn-warning { background: #f39c12; color: #fff; }
        .btn-success { background: #2ecc71; color: #fff; }
        .progress-bar { width: 100%; background: #eee; border-radius: 4px; overflow: hidden; height: 20px; }
        .progress-fill { height: 100%; background: #27ae60; text-align: center; color: #fff; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Sistema de Gestión de Proyectos</h1>
    <div class="nav">
        <button onclick="showTab('personas')">Personas</button>
        <button onclick="showTab('proyectos')">Proyectos</button>
        <button onclick="showTab('actividades')">Actividades</button>
        <button onclick="showTab('tareas')">Tareas</button>
        <button onclick="showTab('registro')">Registro Mensual</button>
        <button onclick="showTab('dashboard')">Dashboard</button>
    </div>

    <!-- Personas -->
    <div id="personas" class="tab active">
        <h2>Gestión de Personas</h2>
        <div class="form-section">
            <h3>Registrar Persona</h3>
            <input type="text" id="nombrePersona" placeholder="Nombre">
            <button class="btn btn-primary" onclick="agregarPersona()">Agregar Persona</button>
        </div>
        <h3>Personas Registradas</h3>
        <table id="tablaPersonas">
            <thead><tr><th>Nombre</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Proyectos -->
    <div id="proyectos" class="tab">
        <h2>Gestión de Proyectos</h2>
        <div class="form-section">
            <h3>Registrar Proyecto</h3>
            <select id="personaProyecto"></select>
            <input type="text" id="nombreProyecto" placeholder="Nombre del Proyecto">
            <button class="btn btn-primary" onclick="agregarProyecto()">Agregar Proyecto</button>
        </div>
        <h3>Proyectos Registrados</h3>
        <table id="tablaProyectos">
            <thead><tr><th>Nombre</th><th>Persona</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Actividades -->
    <div id="actividades" class="tab">
        <h2>Gestión de Actividades</h2>
        <div class="form-section">
            <h3>Registrar Actividad</h3>
            <select id="proyectoActividad"></select>
            <input type="text" id="nombreActividad" placeholder="Nombre de la Actividad">
            <input type="number" id="metaActividad" placeholder="Meta Mensual">
            <button class="btn btn-primary" onclick="agregarActividad()">Agregar Actividad</button>
        </div>
        <h3>Actividades Registradas</h3>
        <table id="tablaActividades">
            <thead><tr><th>Nombre</th><th>Proyecto</th><th>Meta</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Tareas -->
    <div id="tareas" class="tab">
        <h2>Gestión de Tareas</h2>
        <div class="form-section">
            <h3>Registrar Tarea</h3>
            <select id="actividadTarea"></select>
            <input type="text" id="nombreTarea" placeholder="Nombre de la Tarea">
            <input type="text" id="descripcionTarea" placeholder="Descripción">
            <button class="btn btn-primary" onclick="agregarTarea()">Agregar Tarea</button>
        </div>
        <h3>Tareas Registradas</h3>
        <table id="tablaTareas">
            <thead><tr><th>Nombre</th><th>Actividad</th><th>Proyecto</th><th>Descripción</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Registro y Dashboard iguales que antes -->
    <div id="registro" class="tab"><h2>Registro Mensual</h2><p>...</p></div>
    <div id="dashboard" class="tab"><h2>Dashboard</h2><p>...</p></div>

    <script>
        // --- VARIABLES ---
        let personas = JSON.parse(localStorage.getItem("personas")) || [];
        let proyectos = JSON.parse(localStorage.getItem("proyectos")) || [];
        let actividades = JSON.parse(localStorage.getItem("actividades")) || [];
        let tareas = JSON.parse(localStorage.getItem("tareas")) || [];

        function guardarDatos() {
            localStorage.setItem("personas", JSON.stringify(personas));
            localStorage.setItem("proyectos", JSON.stringify(proyectos));
            localStorage.setItem("actividades", JSON.stringify(actividades));
            localStorage.setItem("tareas", JSON.stringify(tareas));
        }

        function showTab(tab) {
            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            document.getElementById(tab).classList.add("active");
            actualizarSelects();
        }

        // --- PERSONAS ---
        function agregarPersona() {
            const nombre = document.getElementById("nombrePersona").value.trim();
            if (!nombre) return alert("Ingrese un nombre");
            personas.push({id: Date.now(), nombre});
            guardarDatos();
            actualizarTablaPersonas();
            document.getElementById("nombrePersona").value = "";
        }
        function editarPersona(id) {
            const p = personas.find(x => x.id === id);
            const nuevo = prompt("Nuevo nombre:", p.nombre);
            if (nuevo) { p.nombre = nuevo; guardarDatos(); actualizarTablaPersonas(); }
        }
        function eliminarPersona(id) {
            personas = personas.filter(p => p.id !== id);
            guardarDatos(); actualizarTablaPersonas();
        }
        function actualizarTablaPersonas() {
            const tbody = document.querySelector("#tablaPersonas tbody");
            tbody.innerHTML = "";
            personas.forEach(p => {
                tbody.innerHTML += `<tr>
                  <td>${p.nombre}</td>
                  <td>
                    <button class="btn btn-warning" onclick="editarPersona(${p.id})">Editar</button>
                    <button class="btn btn-danger" onclick="eliminarPersona(${p.id})">Eliminar</button>
                  </td></tr>`;
            });
            actualizarSelects();
        }

        // --- PROYECTOS ---
        function agregarProyecto() {
            const personaId = +document.getElementById("personaProyecto").value;
            const nombre = document.getElementById("nombreProyecto").value.trim();
            if (!personaId || !nombre) return alert("Complete los datos");
            proyectos.push({id: Date.now(), personaId, nombre});
            guardarDatos(); actualizarTablaProyectos();
            document.getElementById("nombreProyecto").value = "";
        }
        function editarProyecto(id) {
            const p = proyectos.find(x => x.id === id);
            const nuevo = prompt("Nuevo nombre:", p.nombre);
            if (nuevo) { p.nombre = nuevo; guardarDatos(); actualizarTablaProyectos(); }
        }
        function eliminarProyecto(id) {
            proyectos = proyectos.filter(p => p.id !== id);
            guardarDatos(); actualizarTablaProyectos();
        }
        function actualizarTablaProyectos() {
            const tbody = document.querySelector("#tablaProyectos tbody");
            tbody.innerHTML = "";
            proyectos.forEach(p => {
                const persona = personas.find(x => x.id === p.personaId);
                tbody.innerHTML += `<tr>
                  <td>${p.nombre}</td>
                  <td>${persona ? persona.nombre : ""}</td>
                  <td>
                    <button class="btn btn-warning" onclick="editarProyecto(${p.id})">Editar</button>
                    <button class="btn btn-danger" onclick="eliminarProyecto(${p.id})">Eliminar</button>
                  </td></tr>`;
            });
            actualizarSelects();
        }

        // --- ACTIVIDADES ---
        function agregarActividad() {
            const proyectoId = +document.getElementById("proyectoActividad").value;
            const nombre = document.getElementById("nombreActividad").value.trim();
            const meta = +document.getElementById("metaActividad").value;
            if (!proyectoId || !nombre || !meta) return alert("Complete los datos");
            actividades.push({id: Date.now(), proyectoId, nombre, meta});
            guardarDatos(); actualizarTablaActividades();
            document.getElementById("nombreActividad").value = "";
            document.getElementById("metaActividad").value = "";
        }
        function editarActividad(id) {
            const a = actividades.find(x => x.id === id);
            const nuevo = prompt("Nuevo nombre:", a.nombre);
            if (nuevo) { a.nombre = nuevo; }
            const nuevaMeta = prompt("Nueva meta:", a.meta);
            if (nuevaMeta) { a.meta = +nuevaMeta; }
            guardarDatos(); actualizarTablaActividades();
        }
        function eliminarActividad(id) {
            actividades = actividades.filter(a => a.id !== id);
            guardarDatos(); actualizarTablaActividades();
        }
        function actualizarTablaActividades() {
            const tbody = document.querySelector("#tablaActividades tbody");
            tbody.innerHTML = "";
            actividades.forEach(a => {
                const proyecto = proyectos.find(x => x.id === a.proyectoId);
                tbody.innerHTML += `<tr>
                  <td>${a.nombre}</td>
                  <td>${proyecto ? proyecto.nombre : ""}</td>
                  <td>${a.meta}</td>
                  <td>
                    <button class="btn btn-warning" onclick="editarActividad(${a.id})">Editar</button>
                    <button class="btn btn-danger" onclick="eliminarActividad(${a.id})">Eliminar</button>
                  </td></tr>`;
            });
            actualizarSelects();
        }

        // --- TAREAS ---
        function agregarTarea() {
            const actividadId = +document.getElementById("actividadTarea").value;
            const nombre = document.getElementById("nombreTarea").value.trim();
            const desc = document.getElementById("descripcionTarea").value.trim();
            if (!actividadId || !nombre) return alert("Complete los datos");
            tareas.push({id: Date.now(), actividadId, nombre, descripcion: desc});
            guardarDatos(); actualizarTablaTareas();
            document.getElementById("nombreTarea").value = "";
            document.getElementById("descripcionTarea").value = "";
        }
        function editarTarea(id) {
            const t = tareas.find(x => x.id === id);
            const nuevo = prompt("Nuevo nombre:", t.nombre);
            if (nuevo) { t.nombre = nuevo; }
            const nuevaDesc = prompt("Nueva descripción:", t.descripcion);
            if (nuevaDesc !== null) { t.descripcion = nuevaDesc; }
            guardarDatos(); actualizarTablaTareas();
        }
        function eliminarTarea(id) {
            tareas = tareas.filter(t => t.id !== id);
            guardarDatos(); actualizarTablaTareas();
        }
        function actualizarTablaTareas() {
            const tbody = document.querySelector("#tablaTareas tbody");
            tbody.innerHTML = "";
            tareas.forEach(t => {
                const actividad = actividades.find(x => x.id === t.actividadId);
                const proyecto = actividad ? proyectos.find(p => p.id === actividad.proyectoId) : null;
                tbody.innerHTML += `<tr>
                  <td>${t.nombre}</td>
                  <td>${actividad ? actividad.nombre : ""}</td>
                  <td>${proyecto ? proyecto.nombre : ""}</td>
                  <td>${t.descripcion}</td>
                  <td>
                    <button class="btn btn-warning" onclick="editarTarea(${t.id})">Editar</button>
                    <button class="btn btn-danger" onclick="eliminarTarea(${t.id})">Eliminar</button>
                  </td></tr>`;
            });
            actualizarSelects();
        }

        // --- ACTUALIZAR SELECTS ---
        function actualizarSelects() {
            const selPersona = document.getElementById("personaProyecto");
            if (selPersona) {
                selPersona.innerHTML = personas.map(p => `<option value="${p.id}">${p.nombre}</option>`).join("");
            }
            const selProyecto = document.getElementById("proyectoActividad");
            if (selProyecto) {
                selProyecto.innerHTML = proyectos.map(p => `<option value="${p.id}">${p.nombre}</option>`).join("");
            }
            const selActividad = document.getElementById("actividadTarea");
            if (selActividad) {
                selActividad.innerHTML = actividades.map(a => `<option value="${a.id}">${a.nombre}</option>`).join("");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            actualizarTablaPersonas();
            actualizarTablaProyectos();
            actualizarTablaActividades();
            actualizarTablaTareas();
        });
    </script>
</body>
</html>
